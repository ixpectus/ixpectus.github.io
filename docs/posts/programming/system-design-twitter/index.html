<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>System Design Twitter | ixpectus notes</title>



<link rel="stylesheet" href="/css/style.css"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://ixpectus.ru/posts/programming/system-design-twitter/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://ixpectus.ru">
          <h1 id="nav-heading" class="title is-4">ixpectus notes</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/ixpectus'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="email" href='mailto:ixpectus@gmail.com'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/programming/">#programming</a>



  
  | <a class="subtitle is-6" href="/tags/system-design/">#system design</a>
  


      
    </div>
    <h2 class="subtitle is-6">January 30, 2022</h2>
    <h1 class="title">System Design Twitter</h1>
    
    <div class="content">
      <h2 id="как-сейчас-работает-twitterhttpstwittercom">Как сейчас работает <a href="https://twitter.com">twitter</a></h2>
<ul>
<li>Пользователь оставляет текстовое сообщения</li>
<li>Пользователи могут подписываться на сообщения друг друга</li>
<li>После того, как пользователь оставил текстовое сообщение другие пользователи в своих лентах должны увидеть сообщение</li>
</ul>
<h2 id="какое-у-него-сейчас-время-ответа">Какое у него сейчас время ответа</h2>
<h2 id="потенциальные-вопросы">Потенциальные вопросы</h2>
<h3 id="по-нагрузке">По нагрузке</h3>
<ul>
<li>количество активных пользователей в день</li>
<li>какое количество активных пользователей пишет сообщения</li>
<li>сколько в среднем один пользователь пишет сообщений в день</li>
</ul>
<h3 id="по-продукту">По продукту</h3>
<ul>
<li>должна быть авторизация, регистрация</li>
<li>делаем только сайт или должны быть приложения</li>
<li>есть ли ограничение на количество символов от одного пользователя</li>
<li>храним ли мы сообщения от пользователей бесконечно или нет</li>
<li>нужно ли уведомлять пользователей на почту, слать пуши в приложения с уведомлениями о том, что в его ленте появилось новое сообщение</li>
<li>планируем ли собирать аналитику, есть ли тут какие-либо требования</li>
<li>какие странице будут в приложении</li>
<li>есть ли прогноз по заходу на различные типы страниц</li>
<li>будут ли какие-нибудь треды</li>
<li>может ли быть задержка в несколько секунд
<ul>
<li>при попадании поста в чужие ленты</li>
<li>при попадании поста в свою ленту</li>
</ul>
</li>
<li>есть ли пользователи миллионники, как работа должна строится для них</li>
</ul>
<h3 id="нефункциональные-требования">Нефункциональные требования</h3>
<ul>
<li>через какое время после публикации подписчики пользователя должны увидеть сообщения</li>
</ul>
<h2 id="возможные-ответы">Возможные ответы</h2>
<h3 id="по-нагрузке-1">По нагрузке</h3>
<ul>
<li><strong>количество активных пользователей в день</strong> 500млн</li>
<li><strong>какое количество активных пользователей пишет сообщения</strong>  50млн</li>
<li><strong>сколько в среднем один пользователь пишет сообщений в день</strong> 10</li>
</ul>
<h3 id="по-продукту-1">По продукту</h3>
<ul>
<li><strong>должна быть авторизация, регистрация</strong> конечно</li>
<li><strong>делаем только сайт или должны быть приложения</strong> сейчас делаем только веб-версию, в перспективе хотим приложения</li>
<li><strong>есть ли ограничение на количество символов от одного пользователя</strong> давайте сделаем 500</li>
<li><strong>храним ли мы сообщения от пользователей бесконечно или нет</strong> бесконечно</li>
<li><strong>нужно ли уведомлять пользователей на почту, слать пуши в приложения с уведомлениями о том, что в его ленте появилось новое сообщение</strong> нужно слать</li>
<li><strong>планируем ли собирать аналитику, есть ли тут какие-либо требования</strong> хотелось бы</li>
<li><strong>какие странице будут в приложении</strong> ленты с подписками, ленты конкретных пользователей, личный кабинет пользователя</li>
<li><strong>есть ли прогноз по заходу на различные типы страниц</strong> процентов 80 будем смотреть свои ленты, процентов 20 будет смотреть твиты конкретных пользователей</li>
<li><strong>будут ли какие-нибудь треды</strong> на старте нет, в будущем возможно что-то добавим</li>
<li><strong>может ли быть задержка в несколько секунд</strong>
<ul>
<li><strong>при попадании поста в чужие ленты</strong> может быть</li>
<li><strong>при попадании поста в свою ленту</strong> давайте не больше секунды</li>
</ul>
</li>
<li><strong>есть ли пользователи миллионники, как работа должна строится для них</strong> есть, их твиты должны попадать в ленты за 10с</li>
</ul>
<h3 id="нефункциональные-требования-1">Нефункциональные требования</h3>
<ul>
<li><strong>через какое время после публикации подписчики пользователя должны увидеть сообщения</strong> чем быстрее, тем лучше, давайте не больше минуты</li>
</ul>
<h3 id="проблематика-этой-задачи">Проблематика этой задачи</h3>
<ul>
<li>очень много данных(ну это в принципе везде так)</li>
<li>данные очевидно нужно шардировать, и тут нужно придумать какой-то вариант, который позволит на словах безболезненно масштабироваться</li>
<li>чтений существенно больше, чем записи</li>
</ul>
<h3 id="что-точно-должно-быть">Что точно должно быть</h3>
<ul>
<li>куча веб серверов, нагрузку на которые роутит load balancer</li>
<li>у каждого сервера есть свой reverse proxy, который дальше роутит запросы по подам</li>
<li>авторизация
<ul>
<li>внутренние сервисы не должны работать с авторизацией(побочный эффект), они должны только получать id авторизованного пользователя</li>
<li>нужно обогащать запроса авторизационными данными, нужен какой-то сервис, который будет хранить сессии пользователей(lua+tarantool)</li>
<li>авторизация это отдельный сервис со специфическим хранилищем, можно взять tarantool, postgres тоже подойдет(lua+tarantool)</li>
</ul>
</li>
<li>после авторизации id пользователя уже есть в заголовках</li>
<li>нужно шардированное хранилище для хранения данных</li>
<li>нужен сервис постинга данных</li>
<li>нужен сервис чтения данных
<ul>
<li>нужно читать объединенные ленты</li>
<li>нужно читать сообщения конкретных пользователей</li>
</ul>
</li>
</ul>
<h3 id="задачи">Задачи</h3>
<ul>
<li>регистрация</li>
<li>авторизация</li>
<li>пост твита</li>
<li>получение ленты пользователя</li>
<li>получение конкретных сообщений пользователя</li>
</ul>
<h2 id="возможное-решение">Возможное решение</h2>
<h3 id="технические-вопросы">Технические вопросы</h3>
<h3 id="примерные-рассчеты">Примерные рассчеты</h3>

      
    </div>
    
  </div>
</section>



<section class="section">
  <div class="container has-text-centered">
    <p></p>
    
  </div>
</section>





</body>
</html>

