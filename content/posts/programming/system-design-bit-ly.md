---
title: "System design на примере bit.ly"
date: 2022-01-28T20:31:18+03:00
tags:
  - programming
  - system design
summary: "Заметки о возможном интервью по system design для разработки аналога bit.ly"
---
## Как сейчас работает [bitly](https://bitly.com/) 
- Сокращатель ссылок, получает оригинальную ссылку и генерирует новую
- Если сгенерировать ссылку на один и тот же сайт в разных сессиях, то она будет разной

## Какое у него сейчас время ответа
- На генерацию ссылки 1c - 1.5c
- Время редиректа на нужную ссылку колебалось от 140 до 400мс

## Потенциальные вопросы 
### По нагрузке 
- какое количество ежедневно активных пользователей ожидаем
- сколько в среднем один пользователь может оставлять ссылок
- как долго нужно будет хранить созданную ссылку
### По продукту 
- вид ссылки может быть какой угодно, сколько символов должно быть в ссылке, есть ли ограничения
- есть какая-то бизнес модель, на чём планируем в будущем зарабатывать
- есть ли представление о наших потенциальных пользователях(b2b, b2c)
- как планируем продвигать продукт
- хотим ли мы вводить какие-то ограничения на одного юзера, будем ли сейчас думать о фроде, модерации этих ссылок или ссылки могут быть какие угодно
- какие платформы хотим поддерживать, планируются ли приложения
- рассчитываем на какую-то конкретную страну, о нескольких странах или всём мире 
- если одну и ту же ссылку вобьют разные пользователи они должны отличаться или нет 
- будем ли валидировать ссылки
- будем ли ограничивать длину ссылки по размеру
### Нефункциональные требования 
- как долго может происходить создание ссылки
- как долго может происходить редирект после перехода по ссылке

## Возможные ответы 
### По нагрузке 
- `какое количество ежедневно активных пользователей ожидаем` - 10млн будут писать, 100млн читать, но в дальнейшем хочется масштабироваться
- `сколько в среднем один пользователь может оставлять ссылок` - 5, но могут быть и пользователи, которые оставляют тысячи ссылок
- `как долго нужно будет хранить созданную ссылку` - очень долго, допустим год
### По продукту 
- `вид ссылки может быть какой угодно, сколько символов должно быть в ссылке, есть ли ограничения` чем меньше, тем лучше, хотелось бы не больше 5
- `есть какая-то бизнес модель, на чём планируем в будущем зарабатывать` прямо сейчас об этом не думаем, наша цель набрать аудиторию
- `есть ли представление о наших потенциальных пользователях(b2b, b2c)` тоже пока неясно, кому больше зайдет
- `как планируем продвигать продукт` аналогично
- `хотим ли мы вводить какие-то ограничения на одного юзера, будем ли сейчас думать о фроде, модерации этих ссылок или ссылки могут быть какие угодно` возможно стоит предусмотреть какой-то черный список ссылок
- `рассчитываем на какую-то конкретную страну, о нескольких странах или всём мире` сначала запускаемся в России, в дальнейшем хотим масштабироваться
- `если одну и ту же ссылку вобьют разные пользователи они должны отличаться или нет` должны отличаться
- `будем ли валидировать ссылки` валидация только по формату урла
- `будем ли ограничивать длину ссылки по размеру` давайте ограничим, ну пусть 300 символов
### Нефункциональные требования 
- `как долго может происходить создание ссылки` чтобы пользователю, казалось, что всё происходит моментально
- `как долго может происходить редирект после перехода по ссылке` аналогично, пользователь не должен этого замечать

## Возможное решение 
### Технические вопросы 
- по какой логике сокращать ссылки, учитывая требования
  - для одной ссылки могут быть разные сокращенные ссылки
  - максимальное количество символов в ссылке 5
- какое хранилище выбрать
 - количество чтений будет больше, чем записи, но не на порядки(возможно на один порядок, то есть в 10 раз будет больше) 
 - в день пишут 10млн * 5 - 50млн ссылок создаётся

### Как генерировать ссылку
- Хэш функции не очень подходят, поскольку возможные коллизии
- Случайная последовательность тоже может привести к коллизиям, которые нужно разруливать
- Одна и та же ссылка может отличаться(можно учитывать дату и время и ip адрес при кодировании)

### Примерные рассчеты  
- 10млн(пользователь в день, которые создают ссылки) * 5 (среднее количество ссылок) * 300(максимальная длина ссылки) * 4 байта (размер одного символа) = 60000000000 байт = примерно 55 гигабайт в день

