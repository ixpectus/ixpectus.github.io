---
title: "System Design Twitter"
date: 2022-01-30T23:06:48+03:00
tags:
  - programming
  - system design
summary: "Заметки о возможном интервью по system design для разработки аналога twitter"
---

## Как сейчас работает [twitter](https://twitter.com) 
- Пользователь оставляет текстовое сообщения
- Пользователи могут подписываться на сообщения друг друга
- После того, как пользователь оставил текстовое сообщение другие пользователи в своих лентах должны увидеть сообщение

## Какое у него сейчас время ответа

## Потенциальные вопросы 

### По нагрузке 
- количество активных пользователей в день
- какое количество активных пользователей пишет сообщения
- сколько в среднем один пользователь пишет сообщений в день

### По продукту 
- должна быть авторизация, регистрация
- делаем только сайт или должны быть приложения  
- есть ли ограничение на количество символов от одного пользователя
- храним ли мы сообщения от пользователей бесконечно или нет
- нужно ли уведомлять пользователей на почту, слать пуши в приложения с уведомлениями о том, что в его ленте появилось новое сообщение
- планируем ли собирать аналитику, есть ли тут какие-либо требования
- какие странице будут в приложении
- есть ли прогноз по заходу на различные типы страниц
- будут ли какие-нибудь треды
- может ли быть задержка в несколько секунд
  - при попадании поста в чужие ленты
  - при попадании поста в свою ленту
- есть ли пользователи миллионники, как работа должна строится для них


### Нефункциональные требования 
- через какое время после публикации подписчики пользователя должны увидеть сообщения

## Возможные ответы 
### По нагрузке 
- __количество активных пользователей в день__ 500млн
- __какое количество активных пользователей пишет сообщения__  50млн
- __сколько в среднем один пользователь пишет сообщений в день__ 10

### По продукту 
- __должна быть авторизация, регистрация__ конечно
- __делаем только сайт или должны быть приложения__ сейчас делаем только веб-версию, в перспективе хотим приложения
- __есть ли ограничение на количество символов от одного пользователя__ давайте сделаем 500
- __храним ли мы сообщения от пользователей бесконечно или нет__ бесконечно
- __нужно ли уведомлять пользователей на почту, слать пуши в приложения с уведомлениями о том, что в его ленте появилось новое сообщение__ нужно слать
- __планируем ли собирать аналитику, есть ли тут какие-либо требования__ хотелось бы
- __какие странице будут в приложении__ ленты с подписками, ленты конкретных пользователей, личный кабинет пользователя
- __есть ли прогноз по заходу на различные типы страниц__ процентов 80 будем смотреть свои ленты, процентов 20 будет смотреть твиты конкретных пользователей
- __будут ли какие-нибудь треды__ на старте нет, в будущем возможно что-то добавим
- __может ли быть задержка в несколько секунд__
  - __при попадании поста в чужие ленты__ может быть
  - __при попадании поста в свою ленту__ давайте не больше секунды
- __есть ли пользователи миллионники, как работа должна строится для них__ есть, их твиты должны попадать в ленты за 10с

### Нефункциональные требования 
- __через какое время после публикации подписчики пользователя должны увидеть сообщения__ чем быстрее, тем лучше, давайте не больше минуты

### Проблематика этой задачи 
- очень много данных(ну это в принципе везде так)
- данные очевидно нужно шардировать, и тут нужно придумать какой-то вариант, который позволит на словах безболезненно масштабироваться
- чтений существенно больше, чем записи

### Что точно должно быть 
- куча веб серверов, нагрузку на которые роутит load balancer
- у каждого сервера есть свой reverse proxy, который дальше роутит запросы по подам
- авторизация
  - внутренние сервисы не должны работать с авторизацией(побочный эффект), они должны только получать id авторизованного пользователя
  - нужно обогащать запроса авторизационными данными, нужен какой-то сервис, который будет хранить сессии пользователей(lua+tarantool)
  - авторизация это отдельный сервис со специфическим хранилищем, можно взять tarantool, postgres тоже подойдет(lua+tarantool)
- после авторизации id пользователя уже есть в заголовках
- нужно шардированное хранилище для хранения данных
- нужен сервис постинга данных
- нужен сервис чтения данных
  - нужно читать объединенные ленты
  - нужно читать сообщения конкретных пользователей

### Задачи
- регистрация
- авторизация
- пост твита
- получение ленты пользователя
- получение конкретных сообщений пользователя

## Возможное решение 
### Технические вопросы 

### Примерные рассчеты  
