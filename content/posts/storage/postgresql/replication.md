---
title: "Репликация"
date: 2020-07-20T10:26:55+03:00
---

* [Слайды](https://edu.postgrespro.ru/dba1/dba1_18_replica_overview.pdf)

### Виды репликаций

#### Физическая 
* идёт поток двоичных данных с мастера на реплику
* требуется двоичная совместимость серверов(одинаковая платформа и версии postgresql)
* возможна репликация всего кластера

#### Логическая 
* в репликации участвует информация о строках
* требуется совместимость на уровне протокола
* возможна выборочная репликация отдельных таблиц
* доступна с версии 10
* реплицируются измененные строки таблиц(а не команды sql)
* работает по модели подписки, т.е. один сервер публикует изменения, а другой может подписаться на них, это позволяет иметь несколько серверов, которые записывают данные на диск
* в случае если на разных серверах изменились одни и те же данные возникнет конфликт, который нужно будет решить вручную

#### Потоковая репликация 
Реплика подключается к мастеру по протоколу репликации и читает поток записей WAL.
Очистка на основном сервере может удалить версии строк, которые нужны на реплике, в этом случае запрос на реплике отменяется.
Это возможно решить с помощью механизма обратной связи, когда реплика как-то оповещает мастер о том, какие данные ей нужны

#### Синхронная репликация 
После записи в wal мастер ждёт ответа от реплики о том, что изменения применились. Получается, что на реплике изменения будут видны раньше чем на мастере.

#### Асинхронная репликация 
В случае асинхронной репликации мастер не дожидается ответа от реплики, поэтому реплика может немного отставать
